(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{6940:(e,t,a)=>{Promise.resolve().then(a.bind(a,1603))},1603:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var r=a(5155),i=a(2115),n=a(6046),s=a(8998),d=a(9561),o=a(1396),l=a(2282),c=a(3536),u=a(615),h=a(9283),p=a(6469);function v(){let[e,t]=(0,i.useState)([]),[a,v]=(0,i.useState)([]),[f,m]=(0,i.useState)([]),[g,S]=(0,i.useState)([]),[D,x]=(0,i.useState)(null),[y,I]=(0,i.useState)(null),[b,j]=(0,i.useState)([]),[A,k]=(0,i.useState)([]),[O,w]=(0,i.useState)(!1),[C,P]=(0,i.useState)(null),[N,B]=(0,i.useState)([]),E=(0,n.useRouter)();return(0,i.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("jwt");if(!e)throw Error("Authorization token not found");let[a,r,i,n]=await Promise.all([fetch("/api/services"),fetch("/api/addons"),fetch("/api/pets/me",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("/api/reservations",{headers:{Authorization:"Bearer ".concat(e)}})]);if(!a.ok||!r.ok||!i.ok||!n.ok)throw Error("Failed to fetch one or more resources");let[s,d,o,l]=await Promise.all([a.json(),r.json(),i.json(),n.json()]);v(s),m(d),S(o);let c=l.map(e=>{let t=e.details.find(e=>e.serviceId),a=e.details.filter(e=>e.addOnId);return{startDate:e.startDate,service:(null==t?void 0:t.serviceId)||"",addOns:a.map(e=>e.addOnId||""),pets:e.pets.map(e=>({id:e.id,name:e.name,type:e.type,breed:e.breed||"",specialNeeds:e.specialNeeds||""})),totalCost:e.totalCost||0,details:e.details.map(e=>({id:e.id,reservationId:e.reservationId,serviceId:e.serviceId,addOnId:e.addOnId,price:e.price,quantity:e.quantity}))}});B(c),t(c)}catch(e){console.error("Error fetching resources:",e),P("Unable to load resources. Please try again.")}})()},[]),(0,r.jsxs)(s.A,{sx:{p:4},children:[(0,r.jsx)(d.A,{variant:"h4",align:"center",gutterBottom:!0,children:"Book Your Pet Sitting Dates"}),C&&(0,r.jsx)(o.A,{severity:"error",children:C}),(0,r.jsx)(p.Ay,{onClickDay:t=>{x(t);let a=e.find(e=>new Date(e.startDate).toDateString()===t.toDateString());if(a){var r;let e=(null===(r=a.details.find(e=>e.serviceId))||void 0===r?void 0:r.serviceId)||null,t=a.details.filter(e=>e.addOnId).map(e=>e.addOnId);I(e),j(t),k(a.pets.map(e=>e.id))}else I(null),j([]),k([]);P(t>=new Date?null:"Past reservations cannot be edited."),w(!0)},tileClassName:t=>{let{date:a}=t;return e.find(e=>new Date(e.startDate).toDateString()===a.toDateString())?a<new Date?"past-reservation":"future-reservation":""},calendarType:"gregory"}),(0,r.jsx)(l.A,{variant:"contained",color:"primary",sx:{mt:4},onClick:()=>{let t=e.filter(e=>!N.some(t=>t.startDate===e.startDate&&t.service===e.service&&JSON.stringify(t.addOns)===JSON.stringify(e.addOns)&&JSON.stringify(t.pets)===JSON.stringify(e.pets)));if(0===t.length){P("No new reservations to check out.");return}localStorage.setItem("bookings",JSON.stringify(t)),E.push("/checkout")},disabled:0===e.length,children:"Checkout"}),(0,r.jsx)(c.A,{open:O,onClose:()=>w(!1),children:(0,r.jsxs)(s.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,borderRadius:2,width:400,boxShadow:24},children:[(0,r.jsxs)(d.A,{variant:"h6",gutterBottom:!0,children:["Reservation Details for ",null==D?void 0:D.toDateString()]}),(0,r.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Selected Service"}),a.map(e=>(0,r.jsx)(u.A,{control:(0,r.jsx)(h.A,{checked:y===e.id,onChange:()=>I(e.id),disabled:!!(D&&D<new Date)}),label:"".concat(e.name," ($").concat(e.basePricePerDay.toFixed(2),")")},e.id)),(0,r.jsx)(d.A,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Selected Add-Ons"}),f.map(e=>(0,r.jsx)(u.A,{control:(0,r.jsx)(h.A,{checked:b.includes(e.id),onChange:()=>j(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),disabled:!!(D&&D<new Date)}),label:"".concat(e.name," ($").concat(e.price.toFixed(2),")")},e.id)),(0,r.jsx)(d.A,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Selected Pets"}),g.map(e=>(0,r.jsx)(u.A,{control:(0,r.jsx)(h.A,{checked:A.includes(e.id),onChange:()=>k(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),disabled:!!(D&&D<new Date)}),label:e.name},e.id)),D&&D>=new Date&&(0,r.jsx)(l.A,{variant:"contained",color:"primary",sx:{mt:2},onClick:()=>{if(!D||!y||0===A.length){P("Please select a service and at least one pet.");return}let e=a.find(e=>e.id===y),r=b.reduce((e,t)=>{let a=f.find(e=>e.id===t);return e+((null==a?void 0:a.price)||0)},0),i=((null==e?void 0:e.basePricePerDay)||0)+r,n=[{id:Math.random(),reservationId:0,serviceId:y,addOnId:null,price:(null==e?void 0:e.basePricePerDay)||0,quantity:1},...b.map(e=>{let t=f.find(t=>t.id===e);return{id:Math.random(),reservationId:0,serviceId:"",addOnId:e,price:(null==t?void 0:t.price)||0,quantity:1}})],s={startDate:D.toISOString(),service:y,addOns:b,pets:A.map(e=>g.find(t=>t.id===e)),totalCost:i,details:n};t(e=>{let t=e.findIndex(e=>new Date(e.startDate).toISOString()===s.startDate);if(-1!==t){let a=[...e];return a[t]=s,a}return[...e,s]}),w(!1),P(null)},children:"Save Changes"})]})})]})}a(6769),a(1485)},1485:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[0,171,380,282,269,536,645,403,441,517,358],()=>t(6940)),_N_E=e.O()}]);