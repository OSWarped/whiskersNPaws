(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{6940:(e,t,r)=>{Promise.resolve().then(r.bind(r,1603))},1603:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(5155),i=r(2115),o=r(6046),n=r(8998),s=r(9561),l=r(1396),d=r(2282),c=r(3536),u=r(615),h=r(9283),x=r(6469);function m(){let[e,t]=(0,i.useState)([]),[r,m]=(0,i.useState)([]),[f,v]=(0,i.useState)([]),[g,p]=(0,i.useState)([]),[S,j]=(0,i.useState)(null),[k,A]=(0,i.useState)(null),[b,P]=(0,i.useState)([]),[y,C]=(0,i.useState)([]),[D,w]=(0,i.useState)(!1),[B,E]=(0,i.useState)(null),O=(0,o.useRouter)();(0,i.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("jwt");if(!e)throw Error("Authorization token not found");let[t,r,a]=await Promise.all([fetch("/api/services"),fetch("/api/addons"),fetch("/api/pets/me",{headers:{Authorization:"Bearer ".concat(e)}})]);if(!t.ok||!r.ok||!a.ok)throw Error("Failed to fetch one or more resources");let[i,o,n]=await Promise.all([t.json(),r.json(),a.json()]);m(i),v(o),p(n)}catch(e){console.error("Error fetching resources:",e),E("Unable to load resources. Please try again.")}})()},[]);let _=t=>e.some(e=>e.date===t.toDateString());return(0,a.jsxs)(n.A,{sx:{p:4},children:[(0,a.jsx)(s.A,{variant:"h4",align:"center",gutterBottom:!0,children:"Book Your Pet Sitting Dates"}),B&&(0,a.jsx)(l.A,{severity:"error",children:B}),(0,a.jsxs)(s.A,{variant:"h6",sx:{mt:2,mb:2},children:["Total Price: $",e.reduce((e,t)=>{var a;return e+((null===(a=r.find(e=>e.id===t.service))||void 0===a?void 0:a.basePricePerDay)||0)+t.addOns.reduce((e,t)=>{var r;return e+((null===(r=f.find(e=>e.id===t))||void 0===r?void 0:r.price)||0)},0)},0).toFixed(2)]}),(0,a.jsx)(x.Ay,{onClickDay:t=>{j(t);let r=e.find(e=>e.date===t.toDateString());r?(A(r.service),P(r.addOns),C(r.pets)):(A(null),P([]),C([])),w(!0)},tileClassName:e=>{let{date:t}=e;return _(t)?"booked-day":""}}),(0,a.jsx)(d.A,{variant:"contained",color:"primary",sx:{mt:4},onClick:()=>{localStorage.setItem("bookings",JSON.stringify(e)),O.push("/checkout")},disabled:0===e.length,children:"Checkout"}),(0,a.jsx)(c.A,{open:D,onClose:()=>w(!1),children:(0,a.jsxs)(n.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,borderRadius:2,width:400,boxShadow:24},children:[(0,a.jsxs)(s.A,{variant:"h6",gutterBottom:!0,children:["Booking Details for ",null==S?void 0:S.toDateString()]}),(0,a.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"Select Service"}),r.map(e=>(0,a.jsx)(u.A,{control:(0,a.jsx)(h.A,{checked:k===e.id,onChange:()=>A(e.id)}),label:"".concat(e.name," ($").concat(e.basePricePerDay.toFixed(2),")")},e.id)),(0,a.jsx)(s.A,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Select Add-Ons"}),f.map(e=>(0,a.jsx)(u.A,{control:(0,a.jsx)(h.A,{checked:b.includes(e.id),onChange:()=>P(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])}),label:"".concat(e.name," ($").concat(e.price.toFixed(2),")")},e.id)),(0,a.jsx)(s.A,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Select Pets"}),g.map(e=>(0,a.jsx)(u.A,{control:(0,a.jsx)(h.A,{checked:y.includes(e.id),onChange:()=>C(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])}),label:e.name},e.id)),(0,a.jsx)(d.A,{variant:"contained",color:"primary",sx:{mt:2},onClick:()=>{if(!S||!k||0===y.length){E("Please select a service and at least one pet.");return}let e=r.find(e=>e.id===k),a=b.reduce((e,t)=>{let r=f.find(e=>e.id===t);return e+((null==r?void 0:r.price)||0)},0),i=((null==e?void 0:e.basePricePerDay)||0)+a,o={date:S.toDateString(),service:k,addOns:b,pets:y,totalCost:i};t(e=>{let t=e.findIndex(e=>e.date===o.date);if(-1!==t){let r=[...e];return r[t]=o,r}return[...e,o]}),w(!1),E(null)},children:"Save Booking"})]})})]})}r(6769),r(1485)},1485:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[0,171,380,282,269,536,645,403,441,517,358],()=>t(6940)),_N_E=e.O()}]);