(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{3118:(e,t,a)=>{Promise.resolve().then(a.bind(a,5399))},5399:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var r=a(5155),s=a(2115),n=a(6046),o=a(8998),i=a(9561),l=a(5417),c=a(8562),d=a(9234),h=a(6854),x=a(894),u=a(2282),m=a(4156),p=a(3536),j=a(618),A=a(450),g=a(9208);function f(){let[e,t]=(0,s.useState)(null),[a,f]=(0,s.useState)([]),[y,w]=(0,s.useState)([]),[b,v]=(0,s.useState)(!0),[N,S]=(0,s.useState)(""),[k,E]=(0,s.useState)({name:"",type:"",breed:"",specialNeeds:""}),[T,C]=(0,s.useState)(!1),D=(0,n.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=g.A.get("authToken")||localStorage.getItem("jwt")||void 0;if(!e)throw Error("No authentication token found");let a=await fetch("/api/auth/me",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw Error("Failed to fetch user");let r=await a.json();t(r);let s=await fetch("/api/pets/me",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){let e=await s.json();f(e)}else console.error("Failed to fetch pets:",await s.json());let n=await fetch("/api/reservations",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(n.ok){let e=(await n.json()).sort((e,t)=>new Date(t.startDate).getTime()-new Date(e.startDate).getTime());w(e)}else console.error("Failed to fetch reservations:",await n.json())}catch(e){console.error("Error fetching data:",e),D.push("/login")}finally{v(!1)}})()},[D]);let B=e=>{E({...k,[e.target.name]:e.target.value})},P=async()=>{if(!k.name||!k.type){S("Name and type are required.");return}try{let t=g.A.get("authToken")||localStorage.getItem("jwt");if(!t){S("User not authenticated.");return}let a=await fetch("/api/pets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({...k,userId:null==e?void 0:e.id})});if(!a.ok){let e=await a.json();S(e.message||"Failed to add pet.");return}let r=await a.json();f(e=>[...e,r]),E({name:"",type:"",breed:"",specialNeeds:""}),S(""),C(!1)}catch(e){console.error("Error adding pet:",e),S("An error occurred. Please try again.")}},F=async e=>{try{let t=g.A.get("authToken")||localStorage.getItem("jwt");if(!t){S("User not authenticated.");return}let a=await fetch("/api/pets/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok){let e=await a.json();S(e.message||"Failed to remove pet.");return}f(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error removing pet:",e),S("An error occurred. Please try again.")}},O=(e,t,a)=>(0,r.jsxs)(o.A,{sx:{mt:4},children:[(0,r.jsx)(i.A,{variant:"h5",gutterBottom:!0,sx:{color:a},children:t}),0===e.length?(0,r.jsxs)(i.A,{children:["No ",t.toLowerCase(),"."]}):(0,r.jsx)(l.Ay,{container:!0,spacing:2,children:e.map(e=>(0,r.jsx)(l.Ay,{item:!0,xs:12,md:6,children:(0,r.jsxs)(c.A,{elevation:3,sx:{p:3},children:[(0,r.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:new Date(e.startDate).toLocaleDateString()}),(0,r.jsxs)(i.A,{children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,r.jsxs)(i.A,{children:[(0,r.jsx)("strong",{children:"Total Price:"})," $",e.totalPrice.toFixed(2)]}),(0,r.jsx)(i.A,{children:(0,r.jsx)("strong",{children:"Pets:"})}),e.pets.map(e=>(0,r.jsxs)(i.A,{sx:{ml:2},children:["- ",(0,r.jsx)("strong",{children:"Name:"})," ",e.name,(0,r.jsx)("br",{}),"- ",(0,r.jsx)("strong",{children:"Type:"})," ",e.type,e.breed?" - ".concat(e.breed):"",(0,r.jsx)("br",{}),"- ",(0,r.jsx)("strong",{children:"Special Needs:"})," ",e.specialNeeds||"None"]},e.id)),(0,r.jsx)(d.A,{label:e.status,color:"Completed"===e.status?"success":"primary",sx:{mt:2}})]})},e.id))})]}),_=new Date,z=y.filter(e=>new Date(e.startDate)>_),I=y.filter(e=>new Date(e.endDate)<_);return b?(0,r.jsx)(o.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:(0,r.jsx)(h.A,{})}):(0,r.jsxs)(o.A,{sx:{p:4},children:[(0,r.jsxs)(i.A,{variant:"h4",gutterBottom:!0,children:["Welcome, ",null==e?void 0:e.firstName," ",null==e?void 0:e.lastName,"!"]}),(0,r.jsxs)(o.A,{sx:{mt:4},children:[(0,r.jsx)(i.A,{variant:"h5",gutterBottom:!0,children:"Your Pets"}),0===a.length?(0,r.jsx)(i.A,{children:"No pets added yet."}):a.map(e=>(0,r.jsxs)(c.A,{sx:{p:2,mb:2},children:[(0,r.jsxs)(i.A,{children:[(0,r.jsx)("strong",{children:"Name:"})," ",e.name]}),(0,r.jsxs)(i.A,{children:[(0,r.jsx)("strong",{children:"Type:"})," ",e.type,e.breed?" - ".concat(e.breed):""]}),(0,r.jsxs)(i.A,{children:[(0,r.jsx)("strong",{children:"Special Needs:"})," ",e.specialNeeds||"None"]}),(0,r.jsx)(x.A,{onClick:()=>F(e.id),color:"error",sx:{mt:1},children:(0,r.jsx)(A.A,{})})]},e.id)),(0,r.jsx)(u.A,{variant:"contained",color:"primary",onClick:()=>C(!0),sx:{mt:2},children:"Add New Pet"})]}),(0,r.jsx)(m.A,{sx:{my:4}}),(0,r.jsx)(u.A,{variant:"contained",color:"primary",href:"/calendar",sx:{mb:4},children:"Add New Reservation"}),(0,r.jsx)(p.A,{open:T,onClose:()=>C(!1),children:(0,r.jsxs)(o.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,borderRadius:2,boxShadow:24,width:400},children:[(0,r.jsx)(i.A,{variant:"h6",gutterBottom:!0,children:"Add a New Pet"}),N&&(0,r.jsx)(i.A,{color:"error",sx:{mb:2},children:N}),(0,r.jsx)(j.A,{label:"Name",name:"name",value:k.name,onChange:B,fullWidth:!0,required:!0,sx:{mb:2}}),(0,r.jsx)(j.A,{label:"Type",name:"type",value:k.type,onChange:B,fullWidth:!0,required:!0,sx:{mb:2}}),(0,r.jsx)(j.A,{label:"Breed (Optional)",name:"breed",value:k.breed,onChange:B,fullWidth:!0,sx:{mb:2}}),(0,r.jsx)(j.A,{label:"Special Needs (Optional)",name:"specialNeeds",value:k.specialNeeds,onChange:B,fullWidth:!0,sx:{mb:2}}),(0,r.jsx)(u.A,{variant:"contained",color:"primary",onClick:P,sx:{mt:2},children:"Save"})]})}),O(z,"Upcoming Reservations","#28a745"),O(I,"Past Reservations","#dc3545")]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[380,282,269,536,618,417,222,441,517,358],()=>t(3118)),_N_E=e.O()}]);